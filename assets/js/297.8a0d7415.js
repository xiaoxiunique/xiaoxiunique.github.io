(window.webpackJsonp=window.webpackJsonp||[]).push([[297],{958:function(t,a,s){"use strict";s.r(a);var e=s(20),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),s("p",[t._v("参考市面上相同维度的 App 产品，"),s("strong",[t._v("蔚来")]),t._v(" "),s("strong",[t._v("理想")]),t._v("，对其消息系统进行抓包分析。得到比较适合我们自己的"),s("strong",[t._v("消息系统设计")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"理想-one"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#理想-one"}},[t._v("#")]),t._v(" "),s("strong",[t._v("理想 ONE")])]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200902093048109","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200902093048109.png",loading:"lazy"}})]),t._v(" "),s("p",[t._v("理想的消息系统设计师一种集中式的设计，将所有的消息集中管理，"),s("strong",[t._v("评论、赞、通知、私信、车辆")]),t._v("。")]),t._v(" "),s("p",[t._v("在消息中心拉去通知类消息")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200902093631215","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200902093631215.png",loading:"lazy"}})]),t._v(" "),s("p",[t._v("对接口进行抓包如下。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("https://api-app.lixiang.com/mms-api/v1-0/message?status=3&pageNumber=0&appId=chj_app_m01&channelType=1&pageSize=20&category=notice\n")])])]),s("p",[t._v("接口设计上 通过 "),s("code",[t._v("category")]),t._v(" 来区分是哪个渠道上的消息，现在我们请求的是通知 类型的消息，所以 category 为 notice。")]),t._v(" "),s("p",[t._v("接口的"),s("strong",[t._v("响应参数")]),t._v("如下")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"success"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"msg"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SUCCESS"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"data"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pageSize"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pageNumber"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"numberOfElements"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"totalPages"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"totalElements"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"elements"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"requestId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rC21P1A80H2DJJQIGR00"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"messageId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C21P1A80H2DJJQIGR0000000"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"appId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chj_app_m01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"recipient"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3250332467430584322"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sender"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"title"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"理想社区用户公约（试行）"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"summary"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"亲爱的理想用户，为了维护社群的真实，友好的氛围，我们制定了理想的社群规范。"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contentId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"accountId\\":0,\\"avatar\\":\\"\\",\\"comment\\":\\"\\",\\"commentId\\":0,\\"commentType\\":1,\\"createTime\\":1598072448536,\\"level\\":1,\\"messageType\\":\\"notice\\",\\"nickName\\":\\"\\",\\"productId\\":754,\\"surfacePlot\\":\\"https://p.ampmake.com/lixiangzhizao_app/pc_push_system/787334842102195.jpg\\",\\"type\\":1}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"tag"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[Ljava.lang.String;@474616fd"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"category"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"notice"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"encryption"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sendOn"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1598072449000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"receiveOn"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"createdOn"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1598072448000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"updatedOn"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1599009229000")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("我们将返回值和界面放在一起对比一下")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200902095729554","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200902095729554.png",loading:"lazy"}})]),t._v(" "),s("p",[t._v("对比之后，界面元素的各个字段就比较清晰了。"),s("strong",[t._v("action")]),t._v(" 对象中，用来控制 "),s("strong",[t._v("查看详情")]),t._v(" 按钮，具体根据不同的 category 来控制不同的行为，因为现在的通知消息为一篇 "),s("strong",[t._v("文章")]),t._v("，所以 "),s("strong",[t._v("点击")]),t._v(" 查看详情，就是拉去对应文章的信息，action  中 "),s("strong",[t._v("productId")]),t._v(" 就是指向的文章的主键 Id")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200902100643409","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200902100643409.png",loading:"lazy"}})]),t._v(" "),s("p",[t._v("点击跳转至 "),s("strong",[t._v("详情页")]),t._v("，上方展示了 【"),s("strong",[t._v("详情页页面")]),t._v("】 【"),s("strong",[t._v("接口 URL 地址")]),t._v("】 【"),s("strong",[t._v("接口详情")]),t._v("】。可以看到对应的 productId 就是 754.")]),t._v(" "),s("p",[s("strong",[t._v("理想")]),t._v(" 消息分类")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("评论 comment")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200903203901495","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200903203901495.png",loading:"lazy"}})])]),t._v(" "),s("li",[s("p",[t._v("点赞 favour")]),t._v(" "),s("img",{attrs:{src:"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200903203620026.png",alt:"image-20200903203620026"}})]),t._v(" "),s("li",[s("p",[t._v("通知 notice")])]),t._v(" "),s("li",[s("p",[t._v("车辆 vehicle")])])]),t._v(" "),s("h3",{attrs:{id:"蔚来-nio"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#蔚来-nio"}},[t._v("#")]),t._v(" "),s("strong",[t._v("蔚来 NIO")])]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200902141335089","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200902141335089.png",loading:"lazy"}})]),t._v(" "),s("p",[t._v("蔚来的消息入口是放在 IM 中的一个会话，和理想的设计不太一样，消息点击进入之后 分为 "),s("strong",[t._v("互动")]),t._v(" 和 "),s("strong",[t._v("通知")]),t._v("，对互动消息列表的抓包结果如下。")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200902142316083","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200902142316083.png",loading:"lazy"}})]),t._v(" "),s("ul",[s("li")]),t._v(" "),s("p",[t._v("在抓包时发现，在每次请求消息列表 这个接口的时候，还会附带一个 "),s("strong",[t._v("history_read")]),t._v(" 的一个接口")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/api/1/message/history_read?app_id=10002&app_ver=4.4.0&device_id=2c0d36fa578c45c6819e0567399b8704&lang=zh-cn&region=cn&timestamp=1599026946&sign=4be15ff9fa6e02e2fe5b24bb06c74a03\n")])])]),s("p",[t._v("猜测应该是控制当前用户已经读取过当前时间之前的消息。下次进入系统就不会再提示了。")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200902145006665","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200902145006665.png",loading:"lazy"}})]),t._v(" "),s("p",[t._v("在对比 通知里面的消息结构。基本的消息结构就比较明确了。")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200903182245206","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200903182245206.png",loading:"lazy"}})]),t._v(" "),s("p",[t._v("上图是在 "),s("strong",[t._v("蔚来")]),t._v(" 发表了一条 "),s("strong",[t._v("说说")]),t._v(" 之后，获取得到了 11 个点赞，28个评论后，第一次登陆时的在主界面 调用 "),s("strong",[t._v("history_info")]),t._v(" 接口，拉去消息列表。可以看到在 "),s("strong",[t._v("notification")]),t._v(" 分类下有 1 条未读消息，在 "),s("strong",[t._v("social_events")]),t._v(" 分类下有 28 条未读消息。")]),t._v(" "),s("p",[t._v("在 data.msg 数组中，每个类型下都有一条消息。结合界面可以发现，这一条消息就是用来在界面最外面展示的。")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200903183108173","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200903183108173.png",loading:"lazy"}})]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image-20200903183536871","data-src":"https://gitee.com/xiaoxiunique/picgo-image/raw/master/atips/image-20200903183536871.png",loading:"lazy"}})]),t._v(" "),s("p",[t._v("第一张图是 "),s("strong",[t._v("点赞")]),t._v(" 消息对应的 消息结构，第二张图是 "),s("strong",[t._v("评论")]),t._v(" 对应的消息接口。")]),t._v(" "),s("p",[t._v("基本可以确定 "),s("strong",[t._v("蔚来 NIO")]),t._v(" 的消息结构里面主要包括")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("read")]),t._v(" 是否已读。")]),t._v(" "),s("li",[s("strong",[t._v("data")]),t._v(" 内容信息，博客信息和点赞评论信息。")]),t._v(" "),s("li",[s("strong",[t._v("description")]),t._v(" 消息描述，这个字段应该是用于 "),s("strong",[t._v("消息推送")]),t._v(" 的时候的内容。")]),t._v(" "),s("li",[s("strong",[t._v("title")]),t._v(" 在 App 消息列表中呈现的标题。")]),t._v(" "),s("li",[s("strong",[t._v("scenario")]),t._v(" 场景，当前场景为关注，"),s("strong",[t._v("点赞")]),t._v("、"),s("strong",[t._v("收藏")]),t._v("，都在这里面。 like 点赞，comment 收藏")]),t._v(" "),s("li",[s("strong",[t._v("category")]),t._v(" 类别，应该用来区分 "),s("strong",[t._v("互动类通知")]),t._v(" 和 "),s("strong",[t._v("系统类通知。")])]),t._v(" "),s("li",[s("strong",[t._v("msg_id")]),t._v(" 消息ID，因为这样的操作可能会触发消息推送，所以每条需要添加 唯一 ID。")]),t._v(" "),s("li",[s("strong",[t._v("link_value")]),t._v(" 需要跳转到对应的地址 nio:// 这种形式 应该是 客户端的一种方式。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);